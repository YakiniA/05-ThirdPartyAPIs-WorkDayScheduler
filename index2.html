<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="Develop/style.css" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <title>Work Day Scheduler</title>
  </head>

  <body>
    <header class="jumbotron">
      <h1 class="display-3">Work Day Scheduler</h1>
      <p class="lead">A simple calendar app for scheduling your work day</p>
      <p id="currentDay" class="lead"></p>
    </header>
    <div class="container">
      <!-- Timeblocks go here -->
     
    <script type="text/javascript">
     $("#currentDay").text(moment().format('MMMM Do YYYY, h:mm:ss a'));
     var j=9;
     var time = 1;
     var input;
     var schedulerText;
      var schedulerIndex;
  
          for(var i=0 ; i<9; i++){
         
           var form = $("<form>");
           var divRow = $("<div>");
          //  divRow.attr("class", "form-group");
           var label = $("<label>");
           label.attr("for", "inputVal");
           label.attr("index",i);
         
          input = $("<textarea>");
          //  input.attr("type", "text");
          
           input.attr("id", i);
          //  input.attr("index" , i);
           input.attr("name", "inputVal");
           input.attr("rows", "2");
           input.attr("cols", "120");

          var k =i+j;
          
          var hour =moment().hour(); ;
          console.log(hour);
    
          
              if(k>12){
                label.text(time+" PM");
                time++
                 
              }else{
                label.text(k+" AM");
              }
             
              if(k>hour){
                     input.attr("class" , "form-control future");
              }else if(k<hour){
                input.attr("class" , "form-control past");
              }else{
                input.attr("class" , "form-control present");
              }
        

           var button = $("<button>");
           button.attr("type", "button");
           button.attr("class", "saveBtn");

           divRow.append(label);
           divRow.append(input);
           divRow.append(button);
           form.append(divRow);
   
           $(".container").append(divRow);
          
     }
     displayItem();

     $(".saveBtn").click(function(event){
      
      //  var inputValue =  $("#inputVal");
      //  console.log(inputVal);

       var val = $(this).siblings("textarea").val();
       var valIndex = $(this).siblings("label").attr("index");
       console.log("Val" +val);
       console.log("valIndex" +valIndex);
       saveDetails(val, valIndex);
     })

    function saveDetails(text, index){
                
        if(localStorage.getItem("schedulerText") && localStorage.getItem("schedulerIndex")){
                schedulerText = JSON.parse(localStorage.getItem("schedulerText"));
                schedulerIndex = JSON.parse(localStorage.getItem("schedulerIndex"));  
            }else{
                schedulerText = [];
                schedulerIndex = [];
            }  

    schedulerText.push(text);
    schedulerIndex.push(index);

        localStorage.setItem("schedulerText", JSON.stringify(schedulerText));
        localStorage.setItem("schedulerIndex", JSON.stringify(schedulerIndex));
        displayItem();
    }

    function displayItem(){
       var finalSechedulerText = JSON.parse(localStorage.getItem("schedulerText"));
       var finalSchedulerIndex = JSON.parse(localStorage.getItem("schedulerIndex"));
  
  if(finalSchedulerIndex!=null){
       for(var values= 0; values<finalSchedulerIndex.length; values++){
                debugger
                console.log("FinalSchedulerIndexValue" +finalSchedulerIndex[values]);
                input =  $("#finalSchedulerIndex[values]");
                console.log("SchedulerIndex" +input);
                // var inputFinal = input.attr("id", finalSchedulerIndex[values]).val(finalSechedulerText[values]);
                var inputFinal = input.attr("id", finalSchedulerIndex[values]).val(finalSechedulerText[values]);

                console.log("Input Final " +inputFinal);
                divRow.append(inputFinal);
              
    }
    $(".container").append(divRow);
    }
    }
    
    </script>
    </div>

   
  </body>
</html>
